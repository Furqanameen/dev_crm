<% content_for :page_title, "New Contact" %>

<div class="admin-header">
  <div>
    <h1 class="admin-title">New Contact</h1>
    <p class="admin-subtitle">Add a new contact to your CRM</p>
  </div>
  <div class="admin-actions">
    <%= link_to "Back to Contacts", admin_contacts_path, class: "btn btn-outline" %>
  </div>
</div>

<div class="max-w-2xl">
  <%= form_with model: [:admin, @contact], local: true, class: "space-y-6" do |f| %>
    <% if @contact.errors.any? %>
      <div class="alert alert-danger">
        <h4><%= pluralize(@contact.errors.count, "error") %> prohibited this contact from being saved:</h4>
        <ul class="mt-2 list-disc list-inside">
          <% @contact.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="card">
      <div class="card-header">
        <h3 class="text-lg font-semibold">Contact Information</h3>
      </div>
      <div class="card-body space-y-4">
        <div class="form-group">
          <%= f.label :account_type, class: "form-label" %>
          <%= f.select :account_type, options_for_select([
            ['Individual', 'individual'],
            ['Company', 'company']
          ], @contact.account_type || 'individual'), {}, { class: "form-control form-select" } %>
          <p class="text-sm text-gray-600 mt-1">Choose whether this contact is an individual person or a company</p>
        </div>

        <div class="form-group">
          <%= f.label :full_name, class: "form-label" %>
          <%= f.text_field :full_name, class: "form-control", placeholder: "Enter full name" %>
          <p class="text-sm text-gray-600 mt-1">Required for individual accounts, optional for companies</p>
        </div>

        <div class="form-group">
          <%= f.label :company_name, class: "form-label" %>
          <%= f.text_field :company_name, class: "form-control", placeholder: "Enter company name" %>
          <p class="text-sm text-gray-600 mt-1">Required for company accounts</p>
        </div>

        <div class="form-group">
          <%= f.label :email, class: "form-label" %>
          <%= f.email_field :email, class: "form-control", placeholder: "email@example.com" %>
          <p class="text-sm text-gray-600 mt-1">At least one contact method (email or mobile) is required</p>
        </div>

        <div class="form-group">
          <%= f.label :mobile_number, class: "form-label" %>
          <%= f.text_field :mobile_number, class: "form-control", placeholder: "+1 (555) 123-4567" %>
          <p class="text-sm text-gray-600 mt-1">Include country code for international numbers</p>
        </div>

        <div class="form-group">
          <%= f.label :consent_status, class: "form-label" %>
          <%= f.select :consent_status, options_for_select([
            ['Unknown', 'unknown'],
            ['Consented', 'consented'],
            ['Unsubscribed', 'unsubscribed']
          ], @contact.consent_status || 'unknown'), {}, { class: "form-control form-select" } %>
          <p class="text-sm text-gray-600 mt-1">Track the contact's consent status for marketing communications</p>
        </div>

        <div class="form-group">
          <%= f.label :tags, class: "form-label" %>
          <%= f.text_field :tags, class: "form-control", placeholder: "prospect, lead, customer" %>
          <p class="text-sm text-gray-600 mt-1">Separate multiple tags with commas</p>
        </div>

        <div class="form-group">
          <%= f.label :notes, class: "form-label" %>
          <%= f.text_area :notes, rows: 4, class: "form-control", placeholder: "Add any additional notes about this contact..." %>
          <p class="text-sm text-gray-600 mt-1">Optional notes for future reference</p>
        </div>
      </div>
    </div>

    <div class="flex justify-end space-x-3">
      <%= link_to "Cancel", admin_contacts_path, class: "btn btn-outline" %>
      <%= f.submit "Create Contact", class: "btn btn-primary" %>
    </div>
  <% end %>
</div>

<script>
  // Auto-switch between individual and company fields
  document.addEventListener('DOMContentLoaded', function() {
    const accountTypeSelect = document.getElementById('contact_account_type');
    const fullNameGroup = document.querySelector('label[for="contact_full_name"]').closest('.form-group');
    const companyNameGroup = document.querySelector('label[for="contact_company_name"]').closest('.form-group');
    
    function updateFields() {
      if (accountTypeSelect.value === 'individual') {
        fullNameGroup.style.display = 'block';
        companyNameGroup.style.display = 'block';
        fullNameGroup.querySelector('p').textContent = 'Required for individual accounts';
        companyNameGroup.querySelector('p').textContent = 'Optional company/organization name';
      } else {
        fullNameGroup.style.display = 'block';
        companyNameGroup.style.display = 'block';
        fullNameGroup.querySelector('p').textContent = 'Optional contact person name';
        companyNameGroup.querySelector('p').textContent = 'Required for company accounts';
      }
    }
    
    accountTypeSelect.addEventListener('change', updateFields);
    updateFields(); // Initial call
  });
</script>
